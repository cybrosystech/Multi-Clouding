<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template id="external_layout_standard_gts_hr_portal">
        <div t-attf-class="header o_company_#{company.id}_layout"
             t-att-style="report_header_style">
            <div class="row">
                <div class="col-12" style="float:right;">
                    <img t-if="company.logo"
                         t-att-src="image_data_uri(company.logo)"
                         style="max-height: 55px;float:right;margin-top:1px;"
                         alt="Logo"/>
                </div>
            </div>
            <br/>
            <br/>
            <div class="row" style="font-size: 10px !important;">
                <div class="col-6" name="company_address">
                    <span style="text-align:center;"
                          t-field="o.employee_id.sudo().name"/>
                    ,
                    <div t-field="o.employee_id.address_home_id"
                         t-options='{"widget": "contact", "fields": ["address","phone"], "no_marker": true}'
                    />
                </div>
            </div>
        </div>
        <br/>
        <br/>

        <div t-attf-class="article o_report_layout_standard o_company_#{company.id}_layout"
             t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id"
             t-att-data-oe-lang="o and o.env.context.get('lang')">
            <div class="pt-5">
                <!-- This div ensures that the address is not cropped by the header. -->
                <t t-call="web.address_layout"/>
            </div>
            <t t-raw="0"/>
        </div>

        <div t-attf-class="footer o_standard_footer o_company_#{company.id}_layout">
            <div class="row" style="border-top: 1px solid #2A5D8A;">
                <div class="col-9 text-left"
                     style="font-size:10px;">
                    <ul class="list-inline mb4">

                        <t t-set="company" t-value="o.sudo().company_id"/>
                        <li t-if="company.name"
                            class="list-inline-item d-inline">
                            <span class="o_force_ltr" t-field="company.name"/>
                            <t t-esc="'-'"/>
                        </li>
                        <li t-if="company.street"
                            class="list-inline-item d-inline">
                            <span t-field="company.street"/>
                            <t t-esc="'-'"/>
                        </li>
                        <li t-if="company.street2"
                            class="list-inline-item d-inline">
                            <span t-field="company.street2"/>
                            <t t-esc="'-'"/>
                        </li>
                        <li t-if="company.city"
                            class="list-inline-item d-inline">
                            <span t-field="o.sudo().company_id.city"/>
                            <t t-esc="'-'"/>
                        </li>
                        <li t-if="company.state_id.name"
                            class="list-inline-item d-inline">
                            <span t-field="company.state_id.name"/>
                            <t t-esc="'-'"/>
                        </li>
                        <li t-if="company.country_id.name"
                            class="list-inline-item d-inline">
                            <span t-field="company.country_id.name"/>
                        </li>
                    </ul>
                </div>
                <div class="col-3 text-right"
                     style="font-size:12px;text-align:right;">
                    <ul class="list-inline mb4">
                        <li class="list-inline-item d-inline">
                            Powered by
                            <img
                                 src="/gts_hr_portal/static/src/img/Odoo.png"
                                 style="max-height: 19px;max-width: 40px;float:right;margin-top:1px;"
                                 alt="Logo"/>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </template>

    <template id="external_layout_gts_hr_portal">
        <t t-if="not o" t-set="o" t-value="doc"/>

        <t t-if="not company">
            <!-- Multicompany -->
            <t t-if="company_id">
                <t t-set="company" t-value="company_id"/>
            </t>
            <t t-elif="o and 'company_id' in o and o.company_id.sudo()">
                <t t-set="company" t-value="o.company_id.sudo()"/>
            </t>
            <t t-else="else">
                <t t-set="company" t-value="o.company_id.sudo()"/>
            </t>
        </t>
        <t t-call="gts_hr_portal.external_layout_standard_gts_hr_portal">
            <t t-raw="0"/>
        </t>
    </template>


    <template id="hr_payroll.report_payslip">
        <t t-call="web.html_container">
            <t t-foreach="inside_foreach_docs or docs" t-as="o">
                <t t-call="gts_hr_portal.external_layout_gts_hr_portal">
                    <t t-set="o"
                       t-value="o.with_context(lang=o.employee_id.address_home_id.lang or o.env.lang)"/>
                    <div class="page" style="font-size: 10px !important;">
                        <br/>
                        <br/>
                        <br/>
                        <br/>
                        <br/>
                        <br/>
                        <table name="employee-infos"
                               class="table table-sm table-borderless">
                            <thead
                                    style="font-size:13px !important;border-top: 3px solid #2A5D8A !important;;border-bottom: 1px solid #2A5D8A !important;color:#2A5D8A !important;">
                                <tr>
                                    <th class="w-25">
                                        <strong>Payroll Id</strong>
                                    </th>
                                    <th class="w-25">
                                        <strong>Employee Name</strong>
                                    </th>
                                    <th class="w-25">
                                        <strong>Date</strong>
                                    </th>
                                    <th class="w-25">
                                        <strong>Social Security Number</strong>
                                    </th>
                                </tr>

                            </thead>
                            <tr>
                                <td>
                                    <span t-field="o.employee_id.registration_number"/>
                                </td>
                                <td>
                                    <span style="text-align:center;"
                                          t-field="o.employee_id.sudo().name"/>
                                </td>
                                <td>
                                    <span t-field="o.sudo().create_date" t-options='{"widget": "date","format": "dd-MM-yyyy"}'/>
                                </td>
                                <td>
                                    <span t-field="o.sudo().employee_id.social_security"/>
                                </td>
                            </tr>
                        </table>
                        <br/>
                        <t t-set="tot_gross" t-value="0"/>
                        <t t-set="tot_deduction" t-value="0"/>
                        <t t-set="tot_ded" t-value="0"/>

                        <t t-set="tot_net" t-value="0"/>
                        <t t-set="sos_amount"
                           t-value="0"/>
                        <t t-set="pit_amount"
                           t-value="0"/>
                        <br/>
                        <br/>
                        <div class="row">
                            <div class="col" style="width:50%;border:1px;">
                                <table class="table table-sm table-borderless">
                                    <thead
                                            style="font-size:13px !important;border-top: 1px solid #2A5D8A !important;border-bottom: 1px solid #2A5D8A !important;color:#2A5D8A !important;">
                                        <tr>
                                            <th class="w-25">Payments</th>
                                            <th class="w-25"
                                                style="text-align:right;">
                                                Amount
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <span t-foreach="o.sudo().line_ids.filtered(lambda line: line.appears_on_payslip)"
                                              t-as="line">
                                            <t t-if="(line.category_id.code == 'BASIC') or (line.category_id.code == 'ALW') or (line.category_id.code == 'ORS')">
                                                <t t-set="gross"
                                                   t-value="'%.2f'% line.total"/>
                                                <t t-set="tot_gross"
                                                   t-value="tot_gross+float(gross)"/>

                                                <tr>
                                                    <td>
                                                        <span t-field="line.name"/>
                                                    </td>
                                                    <td style="text-align:right;">
                                                        <span t-esc="'{0:,.2f}'.format((line.total))"
                                                        />
                                                    </td>
                                                </tr>
                                            </t>
                                        </span>
                                    </tbody>
                                </table>
                            </div>
                            <div class="col" style="width:50%;border:1px;">
                                <table class="table table-sm table-borderless">
                                    <thead
                                            style="font-size:13px !important;border-top: 1px solid #2A5D8A !important;;border-bottom: 1px solid #2A5D8A !important;color:#2A5D8A !important;">
                                        <tr>
                                            <th class="w-25">Deductions</th>
                                            <th class="w-25"
                                                style="text-align:right;">
                                                Amount
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <span t-foreach="o.sudo().line_ids.filtered(lambda line: line.appears_on_payslip)"
                                              t-as="line">
                                            <t t-if="(line.category_id.code == 'DED') ">
                                                <t t-set="ded"
                                                   t-value="'%.2f'% line.total"/>
                                                <t t-set="tot_ded"
                                                   t-value="tot_ded+float(ded)"/>
                                                <tr>
                                                    <td>
                                                        <span t-field="line.name"/>
                                                    </td>
                                                    <td style="text-align:right;">
                                                        <span t-esc="'{0:,.2f}'.format((abs(line.total)))"/>
                                                    </td>
                                                </tr>
                                            </t>

                                        </span>
                                        <tr>
                                            <th>
                                                Total
                                            </th>
                                            <th style="text-align:right;">
                                                <span t-esc="'{0:,.2f}'.format(abs(tot_ded))"/>
                                            </th>
                                        </tr>
                                        <tr>
                                            <th></th>
                                        </tr>
                                        <tr>
                                            <th></th>
                                        </tr>
                                        <tr>
                                            <th></th>
                                        </tr>

                                        <tr>
                                            <th colspan="2">TAX</th>
                                        </tr>
                                        <t t-set="tot_tax" t-value="0"/>

                                        <span t-foreach="o.sudo().line_ids.filtered(lambda line: line.appears_on_payslip)"
                                              t-as="tax_line">
                                            <t t-if="(tax_line.category_id.code == 'TAX') ">
                                                <t t-if="(tax_line.code == 'PIT')">
                                                    <t t-set="pit_amount"
                                                       t-value="pit_amount+abs(tax_line.total)"/>
                                                </t>
                                                <t t-if="(tax_line.code == 'SOS')">

                                                    <t t-set="sos_amount"
                                                       t-value="sos_amount+abs(tax_line.total)"/>
                                                </t>
                                                <t t-set="tax"
                                                   t-value="round(tax_line.total,2)"/>
                                                <t t-set="tot_tax"
                                                   t-value="tot_tax+float(tax)"/>
                                                <tr>
                                                    <td>
                                                        <span t-field="tax_line.name"/>
                                                    </td>
                                                    <td style="text-align:right;">
                                                        <span t-esc="'{0:,.2f}'.format((abs(tax_line.total)))"/>
                                                    </td>
                                                </tr>
                                            </t>
                                        </span>
                                        <tr>
                                            <th>
                                                Total
                                            </th>
                                            <th style="text-align:right;">
                                                <span t-esc="'{0:,.2f}'.format(abs(tot_tax))"/>

                                            </th>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <br/>

                        <div class="row">
                            <div class="col" style="width:50%;border:1px;">
                                <table class="table table-sm">
                                    <tr>
                                        <th style="width:60%;" class="w-25">
                                            Gross Pay
                                        </th>
                                        <th style="width:40%;text-align:right;"
                                            class="w-25">
                                            <span t-esc="'{0:,.2f}'.format((tot_gross))"/>
                                        </th>
                                    </tr>
                                </table>
                            </div>
                            <t t-set="tot_deduction"
                               t-value="tot_deduction+tot_ded+tot_tax"/>
                            <div class="col" style="width:50%;border:1px;">
                                <table class="table table-sm">
                                    <tr>
                                        <th style="width:60%;" class="w-25">
                                            Total Tax And
                                            Deductions
                                        </th>
                                        <th style="width:40%;text-align:right;"
                                            class="w-25">
                                            <span t-esc="'{0:,.2f}'.format((tot_deduction))"/>
                                        </th>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <t t-set="tot_net"
                           t-value="tot_net+tot_gross-tot_deduction"/>
                        <br/>
                        <br/>
                        <br/>
                        <div class="row">
                            <div class="col" style="width:50%;">
                                <table name="total-infos"
                                       class="table table-sm table-borderless">
                                    <thead
                                            style="font-size:13px !important;border-top: 1px solid #2A5D8A !important;border-bottom: 1px solid #2A5D8A !important;color:#2A5D8A !important;">
                                        <tr>
                                            <th class="w-25" colspan="2"
                                                style="text-align:center;">
                                                <strong>Total This Period
                                                </strong>
                                            </th>
                                        </tr>
                                    </thead>
                                    <t t-set="payslips"
                                       t-value="request.env['hr.payslip'].sudo().search([('employee_id','=',o.employee_id.id)]).filtered(lambda l: l.date_from.month &lt;= o.date_from.month and l.date_from.year == o.date_from.year)"/>
                                    <t t-set="tot_year_gross" t-value="0"/>
                                    <t t-set="tot_year_ded" t-value="0"/>
                                    <t t-set="tot_year_sos" t-value="0"/>
                                    <t t-set="tot_year_pit" t-value="0"/>

                                    <t t-foreach="payslips" t-as="p">
                                        <t t-set="line_gross"
                                           t-value="p.line_ids.filtered(lambda a: a.code == 'GROSS')"/>
                                        <t t-set="tot_year_gross"
                                           t-value="tot_year_gross+abs(line_gross.amount)"/>
                                        <t t-set="line_ded_amounts"
                                           t-value="p.line_ids.filtered(lambda a: a.category_id.code == 'DED').mapped('total')"/>
                                        <t t-set="tot_year_ded"
                                           t-value="tot_year_ded+abs(sum(line_ded_amounts))"/>
                                        <t t-set="line_sos"
                                           t-value="p.line_ids.filtered(lambda a: a.code == 'SOS')"/>
                                        <t t-set="tot_year_sos"
                                           t-value="tot_year_sos+abs(line_sos.amount)"/>
                                        <t t-set="line_pit"
                                           t-value="p.line_ids.filtered(lambda a: a.code == 'PIT')"/>
                                        <t t-set="tot_year_pit"
                                           t-value="tot_year_pit+abs(line_pit.amount)"/>
                                    </t>
                                    <span t-esc="ytd"/>
                                    <tr>
                                        <td class="w-25">
                                            <strong>Gross Pay</strong>
                                        </td>
                                        <td class="w-25"
                                            style="text-align:right;">
                                            <span t-esc="'{0:,.2f}'.format((tot_gross))"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="w-25">
                                            <strong>Deductions</strong>
                                        </td>
                                        <td class="w-25"
                                            style="text-align:right;">
                                            <span t-esc="'{0:,.2f}'.format(abs(tot_ded))"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="w-25">
                                            <strong>Social Security</strong>
                                        </td>
                                        <td class="w-25"
                                            style="text-align:right;">
                                            <span t-esc="'{0:,.2f}'.format((sos_amount))"/>

                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="w-25">
                                            <strong>PIT</strong>
                                        </td>
                                        <td class="w-25"
                                            style="text-align:right;">
                                            <span t-esc="'{0:,.2f}'.format((pit_amount))"/>
                                        </td>
                                    </tr>
                                </table>

                            </div>
                            <div class="col" style="width:50%;">
                                <table name="total-infos"
                                       class="table table-sm table-borderless">
                                    <thead
                                            style="font-size:13px !important;border-top: 1px solid #2A5D8A !important;border-bottom: 1px solid #2A5D8A !important;color:#2A5D8A !important;">
                                        <tr>
                                            <th class="w-25" colspan="2"
                                                style="text-align:center;">
                                                <strong>Total Year To Date -
                                                    <span t-esc="time.strftime('%Y',time.strptime(str(o.date_from),'%Y-%m-%d'))"/>
                                                </strong>
                                            </th>
                                        </tr>
                                    </thead>
                                    <t t-set="payslips"
                                       t-value="request.env['hr.payslip'].sudo().search([('employee_id','=',o.employee_id.id)]).filtered(lambda l: l.date_from.month &lt;= o.date_from.month and l.date_from.year == o.date_from.year)"/>
                                    <t t-set="tot_year_gross" t-value="0"/>
                                    <t t-set="tot_year_ded" t-value="0"/>
                                    <t t-set="tot_year_sos" t-value="0"/>
                                    <t t-set="tot_year_pit" t-value="0"/>

                                    <t t-foreach="payslips" t-as="p">
                                        <t t-set="line_gross"
                                           t-value="p.line_ids.filtered(lambda a: a.category_id.code == 'BASIC' or  a.category_id.code == 'ALW' or a.category_id.code == 'ORS').mapped('total')"/>
                                        <t t-set="tot_year_gross"
                                           t-value="tot_year_gross+abs(sum(line_gross))"/>
                                        <t t-set="line_ded_amounts"
                                           t-value="p.line_ids.filtered(lambda a: a.category_id.code == 'DED').mapped('total')"/>
                                        <t t-set="tot_year_ded"
                                           t-value="tot_year_ded+abs(sum(line_ded_amounts))"/>
                                        <t t-set="line_sos"
                                           t-value="p.line_ids.filtered(lambda a:  a.category_id.code == 'TAX' and a.code == 'SOS')"/>
                                        <t t-set="tot_year_sos"
                                           t-value="tot_year_sos+abs(line_sos.amount)"/>
                                        <t t-set="line_pit"
                                           t-value="p.line_ids.filtered(lambda a:  a.category_id.code == 'TAX' and a.code == 'PIT')"/>
                                        <t t-set="tot_year_pit"
                                           t-value="tot_year_pit+abs(line_pit.amount)"/>
                                    </t>
                                    <span t-esc="ytd"/>
                                    <tr>
                                        <td class="w-25">
                                            <strong>Gross Pay</strong>
                                        </td>
                                        <td style="text-align:right;">
                                            <span t-esc="'{0:,.2f}'.format((tot_year_gross))"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="w-25">
                                            <strong>Deductions</strong>
                                        </td>
                                        <td style="text-align:right;">
                                            <span t-esc="'{0:,.2f}'.format((tot_year_ded))"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="w-25">
                                            <strong>Social Security</strong>
                                        </td>
                                        <td style="text-align:right;">
                                            <span t-esc="'{0:,.2f}'.format((tot_year_sos))"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="w-25">
                                            <strong>PIT</strong>
                                        </td>
                                        <td style="text-align:right;">
                                            <span t-esc="'{0:,.2f}'.format((tot_year_pit))"/>
                                        </td>
                                    </tr>
                                </table>

                            </div>
                        </div>
                        <br/>
                        <br/>

                        <table name="totals"
                               class="table table-sm table-borderless">
                            <tr style="border-bottom: 3px solid #2A5D8A !important;border-top: 1px solid #2A5D8A !important;">
                                <td class="w-25"
                                    style="height:70px;text-align:center;vertical-align: middle;border-right:1px solid #2A5D8A !important;">
                                    <strong>
                                        Tax Period -
                                        (
                                        <span t-esc="time.strftime('%m',time.strptime(str(o.date_from),'%Y-%m-%d'))"/>
                                        )

                                        <span t-esc="time.strftime('%B',time.strptime(str(o.date_from),'%Y-%m-%d'))"/>
                                    </strong>
                                </td>
                                <td class="w-25"
                                    style="height:70px;text-align:center;vertical-align: middle;border-right:1px solid #2A5D8A !important;">
                                    <strong>Pay Period :</strong>
                                    <span t-field="o.date_from"/>
                                    -
                                    <span t-field="o.date_to"/>
                                </td>
                                <td class="w-25"
                                    style="height:70px;vertical-align: middle;border-right:1px solid #2A5D8A !important;">

                                </td>
                            </tr>
                        </table>
                        <table name="contract-infos"
                               class="table table-sm table-bordered">
                            <tr>
                                <td class="w-25">
                                    <strong>Contract Start Date</strong>
                                </td>
                                <td class="w-25">
                                    <strong>Working Schedule</strong>
                                </td>
                                <td class="w-25" name="company-car-title"></td>
                            </tr>
                            <tr>
                                <td>
                                    <span t-field="o.employee_id.first_contract_date"/>
                                </td>
                                <td>
                                    <span t-field="o.employee_id.contract_id.hours_per_week"/>
                                </td>
                                <td class="w-25" name="company-car-model"></td>
                            </tr>
                        </table>

                    </div>
                </t>
            </t>
        </t>
    </template>

    <template id="hr_payroll.report_payslip_lang">
        <t t-foreach="docs" t-as="o">
            <t t-set="inside_foreach_docs" t-value="o"/>
            <t t-call="hr_payroll.report_payslip"
               t-lang="o.sudo().employee_id.sudo().address_home_id.lang"/>
        </t>
    </template>
</odoo>