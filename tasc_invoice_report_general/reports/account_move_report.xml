<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="action_inv_general_template_report" model="ir.actions.report">
        <field name="name">Tasc Invoices/Credit Note</field>
        <field name="model">account.move</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">tasc_invoice_report_general.inv_general_report</field>
        <field name="report_file">tasc_invoice_report_general.inv_general_report</field>
        <field name="paperformat_id"
               ref="tasc_invoice_report_general.paperformat_inv_general_template_report"/>
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="print_report_name">(object._get_report_base_filename())</field>
    </record>
    <template id="tasc_invoice_report_general.inv_general_report">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="tasc_invoice_report_general.report_inv_general_document_order"
                   t-lang="doc.partner_id.lang"/>
            </t>
        </t>
    </template>
    <template id="report_inv_general_document_order">
        <t t-call="tasc_invoice_report_general.external_layout_inv_template">
            <t t-set="doc"
               t-value="doc.with_context({'lang':doc.partner_id.lang})"/>
            <div class="page">
                <div class="oe_structure"/>
                <t t-if="doc.move_type in ['out_refund', 'in_refund']">
                    <p style="text-align:center;font-weight:bold;font-size:18px;">
                        Credit Note
                    </p>
                </t>
                <t t-else="">
                    <p style="text-align:center;font-weight:bold;font-size:18px;">
                        Invoice
                    </p>
                </t>
                <div class="row">
                    <div class="col-6">
                        <div>
                            <span style="font-weight:bold">Bill To:</span>
                        </div>
                        <div>
                            <span t-field="doc.partner_id"
                                  t-options='{"widget": "contact", "fields": ["name", "address"]}'/>
                        </div>

                        <div>
                            <span style="font-weight:bold">Tax ID:</span>
                            <span t-field="doc.partner_id.vat"/>
                        </div>
                    </div>
                    <div class="col-6">
                        <div>
                            <t t-if="doc.move_type in ['out_refund', 'in_refund']">
                                <span style="font-weight:bold">Credit Note
                                    Date:
                                </span>
                            </t>
                            <t t-else="">
                                <span style="font-weight:bold">Invoice Date:
                                </span>
                            </t>
                            <span t-field="doc.invoice_date"/>
                        </div>
                        <div>
                            <t t-if="doc.move_type in ['out_refund', 'in_refund']">
                                <span style="font-weight:bold">Credit Note
                                    No.:
                                </span>
                            </t>
                            <t t-else="">
                                <span style="font-weight:bold">Invoice No.:
                                </span>
                            </t>
                            <span t-field="doc.name"/>
                        </div>
                        <div>
                            <t t-if="doc.invoice_payment_term_id">
                                <span style="font-weight:bold">Payment
                                    Terms:
                                </span>
                                <span t-field="doc.invoice_payment_term_id.name"/>
                            </t>
                            <t t-else="">
                                <span style="font-weight:bold">Due Date:
                                </span>
                                <span t-field="doc.invoice_date_due"/>
                            </t>
                        </div>
                        <div>
                            <span style="font-weight:bold">Currency:
                            </span>
                            <span t-field="doc.currency_id.name"/>
                        </div>
                    </div>
                </div>
                <style>
                    .custom_table_lines thead th, .custom_table_lines tbody
                    td{
                    border: 2px solid #636161;
                    padding: 5px;
                    }
                    .custom_table_lines thead th{
                    background: #ccc;
                    color: #636161;
                    }
                    .box{
                    width: 100%;
                    border: 1px solid #ccc !important;
                    margin-bottom: 10px;
                    padding: 5px;
                    }
                    .totals_box{
                    border: 1px solid #ccc !important;
                    margin-bottom: 10px;
                    padding: 5px;
                    float: right;
                    width: 25%;
                    }
                    .totals_box{
                    width: 25%;
                    position: relative;
                    right: 0;
                    }
                    .totals_amount_line{
                    padding: 40px 20px;
                    }
                </style>
                <br/>
                <div>
                    <table class="custom_table_lines" width="100%">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Description</th>
                                <th>Qty</th>
                                <th>Unit price
                                </th>
                                <th>Tax %
                                </th>
                                <th>Total Amount
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="line_index" t-value="0"/>
                            <t t-foreach="doc.invoice_line_ids" t-as="line">
                                <tr>
                                    <td>
                                        <span t-set="line_index"
                                              t-value="line_index+1"/>

                                        <span t-esc="line_index"/>
                                    </td>
                                    <td>
                                        <span t-esc="line.name"/>
                                    </td>
                                    <td>
                                        <span t-esc="line.quantity"/>
                                    </td>
                                    <td>
                                        <span t-field="line.price_unit"/>
                                    </td>
                                    <td>
                                        <span t-esc="line.tax_ids.description or line.tax_ids.name"/>
                                    </td>
                                    <td>
                                        <span t-esc="line.price_subtotal"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>
                <div class="row">
                    <div class="col-7"/>
                    <div class="col-5 row" style="text-align: right;">
                        <div class="col-8 text-right" style="text-align: right;">
                            <span style="font-weight:bold">Sub Total
                            </span>
                            <br/>
                            <span style="font-weight:bold">
                                <t t-if="taxes">
                                    <span t-esc="', '.join(map(lambda x: (x.name), doc.invoice_line_ids.mapped('tax_ids')))"/>
                                </t>
                                <t t-else="">
                                    <span>Tax</span>
                                </t>
                            </span>
                            <br/>
                            <span style="font-weight:bold">Total
                            </span>
                        </div>
                        <div class="col-4" style="text-align: right;">
                            <t t-set="amount_untaxed"
                               t-value="'{:20,.2f}'.format(doc.amount_untaxed)"/>
                            <span t-esc="doc.currency_id.symbol"/>
                            <span style="font-weight:bold"
                                  t-esc="'{:20,.2f}'.format(doc.amount_untaxed)"/>
                            <br/>
                            <span t-esc="doc.currency_id.symbol"/>
                            <span style="font-weight:bold"
                                  t-esc="'{:20,.2f}'.format(doc.amount_tax)"/>
                            <br/>
                            <span t-esc="doc.currency_id.symbol"/>
                            <span style="font-weight:bold"
                                  t-esc="'{:20,.2f}'.format(doc.amount_total)"/>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <img t-if="doc.company_id.company_stamp"
                             class="float-right"
                             style="max-width: 100%; height: 70px;"
                             t-att-src="image_data_uri(doc.company_id.company_stamp)"
                             alt="Stamp"/>
                    </div>
                </div>
                <div class="row" style="position:fixed;top:1100px;line-break:avoid;width:1000px;">
                    <div class="col-lg">
                        <t t-if="doc.move_type in ['out_refund', 'in_refund']">
                            <span style="font-weight:bold;">This is an
                                automated
                                Credit Note and no signature required.
                            </span>
                        </t>
                        <t t-else="">
                            <span style="font-weight:bold;">This is an
                                automated
                                invoice and no signature required.
                            </span>

                        </t>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
